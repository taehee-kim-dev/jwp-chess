<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
        crossorigin="anonymous">

  <title>인비의 체스게임</title>
</head>
<body>

<h1 class="display-4 text-center" style="margin-top: 80px;margin-bottom: 40px;">인비의 체스 게임</h1>

<ul class="list-group text-center" style="width: 400px; margin-left: auto; margin-right: auto">
  {{#notFullGamesIdAndTitle}}
  <li id="{{id}}" class="list-group-item" style="display: flex">
    <button type="button" class="btn btn-light enter-room-button" style="width: 100%">{{title}}</button>
  </li>
  {{/notFullGamesIdAndTitle}}
</ul>

<form action="/rooms" method="post" style="width: 260px; margin-top: 40px; margin-left: auto; margin-right: auto" onsubmit="return create_room_check();">
  <div class="row mb-3">
    <div>
      <input type="text" class="form-control" id="new_room_title" name="roomTitle" placeholder="방 제목을 입력하세요">
    </div>
  </div>
  <div class="row mb-3">
    <div>
      <input type="password" class="form-control" id="white-player-password" name="whitePlayerPassword" placeholder="비밀번호를 입력하세요">
    </div>
  </div>
  <input class="btn btn-outline-primary" type="submit" id="create_room_button" value="방 생성" style="width: 100%"/>
</form>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
<script type="text/javascript">
  const HOME = 'http://localhost:8080';

  const enter_room_buttons =  document.getElementsByClassName("enter-room-button");

  for (let i = 0; i < enter_room_buttons.length; i++) {
    enter_room_buttons[i].addEventListener('click', (event) => {
      const black_player_password = prompt("비밀번호를 입력하세요.");
      if (black_player_password.length < 5) {
        alert('비밀번호는 5자 이상이어야 합니다.');
        return;
      }

      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/join', true);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.responseType = 'json';
      xhr.send(JSON.stringify({
        gameId : event.target.parentElement.id,
        blackPlayerPassword : black_player_password
      }));
      xhr.onload = function () {
        window.location.href = HOME + '/rooms?id=' + event.target.parentElement.id;
      };
    });
  }

  function create_room_check() {
    const room_title_min_size = 5;

    const new_room_title = document.getElementById('new_room_title');
    if(new_room_title.value.length < room_title_min_size) {
      alert('방 제목은 ' + room_title_min_size + '글자 이상이어야 합니다.');
      new_room_title.focus();
      return false;
    }

    const white_player_password = document.getElementById('white-player-password');
    if(white_player_password.value.length < room_title_min_size) {
      alert('비밀번호는 ' + room_title_min_size + '자 이상이어야 합니다.');
      white_player_password.focus();
      return false;
    }

    return true;
  }
</script>
</body>
</html>